<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‹¤æ€ ç®¡ç†SaaS - ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ•ãƒ©ã‚°å®Ÿæ¼”</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 2rem;
        }
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        .card {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid #667eea;
        }
        .card h3 {
            margin-top: 0;
            color: #333;
        }
        .feature-flag {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: #f8f9fa;
            margin: 1rem 0;
            border-radius: 6px;
        }
        .flag-enabled {
            background: #e8f5e8;
            border-left: 4px solid #28a745;
        }
        .flag-disabled {
            background: #fff2f2;
            border-left: 4px solid #dc3545;
        }
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.875rem;
            font-weight: 600;
        }
        .status-enabled {
            background: #28a745;
            color: white;
        }
        .status-disabled {
            background: #dc3545;
            color: white;
        }
        .controls {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            margin: 0.5rem;
            font-weight: 600;
        }
        button:hover {
            background: #5a6fd8;
        }
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
        .api-info {
            background: #e3f2fd;
            padding: 1rem;
            border-radius: 6px;
            margin-top: 1rem;
            font-family: monospace;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ• å‹¤æ€ ç®¡ç†SaaS</h1>
        <p>ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ•ãƒ©ã‚°ã‚·ã‚¹ãƒ†ãƒ çµ±åˆãƒ‡ãƒ¢</p>
        <div class="api-info">
            API URL: https://7wslqwkrvj.execute-api.ap-northeast-1.amazonaws.com/featureflagprodlambda/<br>
            Tenant: attendance-tenant-001
        </div>
    </div>

    <div class="controls">
        <h3>ğŸ›ï¸ ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ•ãƒ©ã‚°åˆ¶å¾¡</h3>
        <button onclick="loadFlags()">ğŸ”„ ãƒ•ãƒ©ã‚°çŠ¶æ…‹ã‚’æ›´æ–°</button>
        <button onclick="clearCache()">ğŸ—‘ï¸ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢</button>
        <button onclick="testBatchEvaluation()">ğŸ“Š ä¸€æ‹¬è©•ä¾¡ãƒ†ã‚¹ãƒˆ</button>
    </div>

    <div class="dashboard">
        <div class="card">
            <h3>ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h3>
            <div id="dashboard-content">
                <div class="feature-flag" data-flag="attendance_new_dashboard">
                    <div>
                        <strong>æ–°ã—ã„ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</strong><br>
                        <small>ãƒ¢ãƒ€ãƒ³ãªUI/UXã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</small>
                    </div>
                    <span class="status-badge status-disabled">ç„¡åŠ¹</span>
                </div>
                <div id="new-dashboard" style="display: none;">
                    <h4>ğŸš€ æ–°ã—ã„ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰UI</h4>
                    <p>ã‚°ãƒ©ãƒ•ã‚£ã‚«ãƒ«ãªå‡ºå‹¤çŠ¶æ³ã€AIãƒ™ãƒ¼ã‚¹ã®ã‚¤ãƒ³ã‚µã‚¤ãƒˆã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥æ©Ÿèƒ½</p>
                </div>
                <div id="old-dashboard">
                    <h4>ğŸ“‹ å¾“æ¥ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h4>
                    <p>åŸºæœ¬çš„ãªå‹¤æ€ ä¸€è¦§ã€ã‚·ãƒ³ãƒ—ãƒ«ãªçµ±è¨ˆè¡¨ç¤º</p>
                </div>
            </div>
        </div>

        <div class="card">
            <h3>ğŸ“± ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒª</h3>
            <div class="feature-flag" data-flag="attendance_mobile_app">
                <div>
                    <strong>ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªæ©Ÿèƒ½</strong><br>
                    <small>ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³å¯¾å¿œæ©Ÿèƒ½</small>
                </div>
                <span class="status-badge status-disabled">ç„¡åŠ¹</span>
            </div>
            <div id="mobile-features" style="display: none;">
                <p>âœ… GPSä½ç½®æƒ…å ±æ‰“åˆ»</p>
                <p>âœ… ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥</p>
                <p>âœ… ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œ</p>
            </div>
        </div>

        <div class="card">
            <h3>ğŸ¤– AIæ©Ÿèƒ½</h3>
            <div class="feature-flag" data-flag="attendance_ai_suggestions">
                <div>
                    <strong>AIå‹¤æ€ ææ¡ˆ</strong><br>
                    <small>æ©Ÿæ¢°å­¦ç¿’ã«ã‚ˆã‚‹å‹¤æ€ æ”¹å–„ææ¡ˆ</small>
                </div>
                <span class="status-badge status-disabled">ç„¡åŠ¹</span>
            </div>
            <div id="ai-features" style="display: none;">
                <p>ğŸ§  å‹¤å‹™ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ</p>
                <p>ğŸ’¡ æ®‹æ¥­æ™‚é–“æœ€é©åŒ–ææ¡ˆ</p>
                <p>ğŸ“ˆ ç”Ÿç”£æ€§å‘ä¸Šã‚¢ãƒ‰ãƒã‚¤ã‚¹</p>
            </div>
        </div>

        <div class="card">
            <h3>ğŸ”” é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ </h3>
            <div class="feature-flag" data-flag="attendance_realtime_notifications">
                <div>
                    <strong>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥</strong><br>
                    <small>å³åº§ã®ã‚¢ãƒ©ãƒ¼ãƒˆé…ä¿¡</small>
                </div>
                <span class="status-badge status-enabled">æœ‰åŠ¹</span>
            </div>
            <div id="notification-features">
                <p>âš¡ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‹¤æ€ ã‚¢ãƒ©ãƒ¼ãƒˆ</p>
                <p>ğŸ“§ ãƒ¡ãƒ¼ãƒ«ãƒ»Slacké€£æº</p>
                <p>â° è‡ªå‹•ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼</p>
            </div>
        </div>

        <div class="card">
            <h3>ğŸ“ˆ é«˜åº¦ãªãƒ¬ãƒãƒ¼ãƒˆ</h3>
            <div class="feature-flag" data-flag="attendance_advanced_reporting">
                <div>
                    <strong>è©³ç´°åˆ†æãƒ¬ãƒãƒ¼ãƒˆ</strong><br>
                    <small>é«˜åº¦ãªãƒ‡ãƒ¼ã‚¿åˆ†ææ©Ÿèƒ½</small>
                </div>
                <span class="status-badge status-disabled">ç„¡åŠ¹</span>
            </div>
            <div id="reporting-features" style="display: none;">
                <p>ğŸ“Š ã‚«ã‚¹ã‚¿ãƒ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</p>
                <p>ğŸ“‹ è©³ç´°CSVãƒ»PDFã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</p>
                <p>ğŸ” å¤šæ¬¡å…ƒãƒ‡ãƒ¼ã‚¿åˆ†æ</p>
            </div>
        </div>
    </div>

    <div class="card">
        <h3>ğŸ” ãƒ•ãƒ©ã‚°è©•ä¾¡ãƒ­ã‚°</h3>
        <div id="evaluation-log" style="font-family: monospace; background: #f8f9fa; padding: 1rem; border-radius: 4px; max-height: 300px; overflow-y: auto;">
            ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•ä¸­...
        </div>
    </div>

    <script src="feature-flag-integration/client/index.js"></script>
    <script>
        // ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ•ãƒ©ã‚°ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆæœŸåŒ–
        const flagClient = new FeatureFlagClient({
            apiEndpoint: 'https://7wslqwkrvj.execute-api.ap-northeast-1.amazonaws.com/featureflagprodlambda',
            tenantId: 'attendance-tenant-001',
            cacheTTL: 2 * 60 * 1000 // 2åˆ†ã‚­ãƒ£ãƒƒã‚·ãƒ¥
        });

        const flagKeys = [
            'attendance_new_dashboard',
            'attendance_mobile_app', 
            'attendance_ai_suggestions',
            'attendance_realtime_notifications',
            'attendance_advanced_reporting'
        ];

        function log(message) {
            const logElement = document.getElementById('evaluation-log');
            const timestamp = new Date().toLocaleTimeString('ja-JP');
            logElement.innerHTML += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        async function updateFeatureFlag(flagKey, enabled) {
            const flagElement = document.querySelector(`[data-flag="${flagKey}"]`);
            const statusBadge = flagElement.querySelector('.status-badge');
            
            // UIæ›´æ–°
            flagElement.className = `feature-flag ${enabled ? 'flag-enabled' : 'flag-disabled'}`;
            statusBadge.className = `status-badge ${enabled ? 'status-enabled' : 'status-disabled'}`;
            statusBadge.textContent = enabled ? 'æœ‰åŠ¹' : 'ç„¡åŠ¹';

            // æ©Ÿèƒ½è¡¨ç¤º/éè¡¨ç¤º
            const featureElementIds = {
                'attendance_new_dashboard': ['new-dashboard', 'old-dashboard'],
                'attendance_mobile_app': ['mobile-features'],
                'attendance_ai_suggestions': ['ai-features'],
                'attendance_realtime_notifications': ['notification-features'],
                'attendance_advanced_reporting': ['reporting-features']
            };

            const elementIds = featureElementIds[flagKey];
            if (elementIds) {
                elementIds.forEach((id, index) => {
                    const element = document.getElementById(id);
                    if (element) {
                        if (flagKey === 'attendance_new_dashboard') {
                            // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¯åˆ‡ã‚Šæ›¿ãˆ
                            element.style.display = (enabled && index === 0) || (!enabled && index === 1) ? 'block' : 'none';
                        } else {
                            // ãã®ä»–ã¯è¡¨ç¤º/éè¡¨ç¤º
                            element.style.display = enabled ? 'block' : 'none';
                        }
                    }
                });
            }

            log(`ğŸ¯ ${flagKey}: ${enabled ? 'ENABLED' : 'DISABLED'}`);
        }

        async function loadFlags() {
            log('ğŸ”„ ãƒ•ãƒ©ã‚°çŠ¶æ…‹ã‚’å–å¾—ä¸­...');
            document.body.classList.add('loading');
            
            try {
                for (const flagKey of flagKeys) {
                    const enabled = await flagClient.isEnabled(flagKey);
                    await updateFeatureFlag(flagKey, enabled);
                }
                log('âœ… å…¨ãƒ•ãƒ©ã‚°ã®çŠ¶æ…‹å–å¾—å®Œäº†');
            } catch (error) {
                log(`âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            } finally {
                document.body.classList.remove('loading');
            }
        }

        async function clearCache() {
            flagClient.clearCache();
            log('ğŸ—‘ï¸ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
        }

        async function testBatchEvaluation() {
            log('ğŸ“Š ä¸€æ‹¬è©•ä¾¡ãƒ†ã‚¹ãƒˆé–‹å§‹...');
            try {
                const results = await flagClient.evaluateMultiple(flagKeys);
                log(`ğŸ“‹ ä¸€æ‹¬è©•ä¾¡çµæœ: ${JSON.stringify(results, null, 2)}`);
                
                // UIæ›´æ–°
                for (const [flagKey, enabled] of Object.entries(results)) {
                    await updateFeatureFlag(flagKey, enabled);
                }
            } catch (error) {
                log(`âŒ ä¸€æ‹¬è©•ä¾¡ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }

        // åˆæœŸãƒ­ãƒ¼ãƒ‰
        document.addEventListener('DOMContentLoaded', () => {
            log('ğŸš€ å‹¤æ€ ç®¡ç†SaaS ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ•ãƒ©ã‚°ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•');
            log('ğŸ”— æœ¬ç•ªAPIæ¥ç¶šä¸­...');
            loadFlags();
        });

        // å®šæœŸçš„ãªçŠ¶æ…‹æ›´æ–°ï¼ˆ30ç§’ã”ã¨ï¼‰
        setInterval(() => {
            log('â° å®šæœŸãƒ•ãƒ©ã‚°çŠ¶æ…‹ãƒã‚§ãƒƒã‚¯');
            loadFlags();
        }, 30000);
    </script>
</body>
</html>