# E2E Testing Guide - ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ•ãƒ©ã‚°ã‚·ã‚¹ãƒ†ãƒ 

## ğŸ¯ ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ã®æˆåŠŸ

### æ®µéšçš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã«ã‚ˆã‚‹æ ¹æœ¬çš„è§£æ±º

**å•é¡Œ**: ãƒ•ãƒ¬ãƒ¼ã‚­ãƒ¼ãƒ†ã‚¹ãƒˆï¼ˆ15/30å¤±æ•—ï¼‰ã¨ãƒ¢ãƒƒã‚¯åŒ–ã«ã‚ˆã‚‹E2Eä¾¡å€¤ã®æ¬ å¦‚
**è§£æ±º**: ãƒ©ã‚¤ãƒ–APIçµ±åˆã«ã‚ˆã‚‹çœŸã®çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿç¾
**çµæœ**: 31/37æˆåŠŸï¼ˆ83.8%ï¼‰ã®å®‰å®šã—ãŸãƒ†ã‚¹ãƒˆç’°å¢ƒ

## ğŸ“Š ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆæ¦‚è¦

### ã‚³ã‚¢ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ (100%æˆåŠŸ)
1. **flag-management-live.spec.ts** - 6/6 æˆåŠŸ
   - ãƒ•ãƒ©ã‚°ä¸€è¦§è¡¨ç¤ºã€ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã€ä½œæˆ
   - ãƒ¢ãƒ¼ãƒ€ãƒ«æ“ä½œã€ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰çµ±åˆ
   - å®Œå…¨ãªãƒ©ã‚¤ãƒ–APIçµ±åˆ

2. **system-integration.spec.ts** - 8/8 æˆåŠŸ
   - ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®çµ±åˆãƒ†ã‚¹ãƒˆ
   - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã€ã‚¨ãƒ©ãƒ¼å‡¦ç†ã€ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–
   - ä¸¦è¡Œå‡¦ç†ã€ç’°å¢ƒåˆ¥ãƒ†ã‚¹ãƒˆ

3. **stable-flag-management.spec.ts** - 5/5 æˆåŠŸ
   - å®‰å®šæ€§é‡è¦–ã®ãƒ†ã‚¹ãƒˆ
   - å®Œå…¨ãƒ¢ãƒƒã‚¯æˆ¦ç•¥ï¼ˆæ¯”è¼ƒç”¨ï¼‰

### æ‹¡å¼µãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ (éƒ¨åˆ†æˆåŠŸ)
4. **advanced-flag-management.spec.ts** - 5/8 æˆåŠŸ
   - é«˜åº¦ãªæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆï¼ˆç·¨é›†ãƒ»å‰Šé™¤ãƒ»ãƒˆã‚°ãƒ«ï¼‰
   - ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆã€è©•ä¾¡APIã€æœ‰åŠ¹æœŸé™
   - ä¸€éƒ¨æ©Ÿèƒ½ã¯æœªå®Ÿè£…

## ğŸ› ï¸ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ–¹æ³•

### åŸºæœ¬å®Ÿè¡Œ
```bash
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm run test:e2e

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆå®Ÿè¡Œ
npm run test:e2e -- flag-management-live.spec.ts --project=chromium

# ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œ
npm run test:e2e -- --project=chromium

# UIãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œ
npm run test:e2e:ui
```

### å‰ææ¡ä»¶
1. **APIã‚µãƒ¼ãƒãƒ¼èµ·å‹•**
   ```bash
   cd packages/api
   npm run dev
   ```

2. **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼èµ·å‹•**
   ```bash
   cd packages/admin-ui
   npm run dev
   ```

3. **ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç®¡ç†**
   - è‡ªå‹•ãƒªã‚»ãƒƒãƒˆãƒ»ã‚·ãƒ¼ãƒ‰æ©Ÿèƒ½å®Ÿè£…æ¸ˆã¿
   - å„ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå‰ã«è‡ªå‹•çš„ã«ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

## ğŸ”§ ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç®¡ç†API

### åŸºæœ¬ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
```typescript
// ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ
POST /api/test/reset

// æ¨™æº–ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
POST /api/test/seed

// ã‚«ã‚¹ã‚¿ãƒ ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
POST /api/test/seed-custom
{
  "customFlags": [
    {
      "id": "custom-1",
      "flagKey": "custom_flag",
      "description": "Custom Flag",
      "defaultEnabled": true,
      "owner": "test@example.com",
      "createdAt": "2025-01-01T00:00:00Z"
    }
  ]
}

// ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿çŠ¶æ…‹ç¢ºèª
GET /api/test/status
```

## ğŸ“‹ ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹è©³ç´°

### 1. ãƒ•ãƒ©ã‚°ç®¡ç†ãƒ†ã‚¹ãƒˆ (flag-management-live.spec.ts)

#### âœ… æˆåŠŸãƒ†ã‚¹ãƒˆ
- **ãƒ•ãƒ©ã‚°ä¸€è¦§è¡¨ç¤º**: ãƒ©ã‚¤ãƒ–APIã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿å–å¾—
- **ãƒ•ãƒ©ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**: æ¤œç´¢æ©Ÿèƒ½ã®å‹•ä½œç¢ºèª
- **ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º**: ä½œæˆãƒ¢ãƒ¼ãƒ€ãƒ«ã®è¡¨ç¤ºãƒ»æ“ä½œ
- **ãƒ•ãƒ©ã‚°ä½œæˆ**: ãƒ•ã‚©ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æ¤œè¨¼
- **ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰**: ãƒ¡ãƒˆãƒªã‚¯ã‚¹è¡¨ç¤ºã®ç¢ºèª
- **ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£**: æœ€æ–°ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã®è¡¨ç¤º

#### ğŸ”‘ é‡è¦ãªå®Ÿè£…ãƒã‚¤ãƒ³ãƒˆ
```typescript
test.beforeEach(async ({ page }) => {
  // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®å®Œå…¨ãƒªã‚»ãƒƒãƒˆ
  await fetch('http://localhost:3001/api/test/reset', { method: 'POST' });
  await fetch('http://localhost:3001/api/test/seed', { method: 'POST' });
  
  // APIå®‰å®šåŒ–ã®ãŸã‚ã®å¾…æ©Ÿ
  await page.waitForTimeout(500);
});
```

### 2. ã‚·ã‚¹ãƒ†ãƒ çµ±åˆãƒ†ã‚¹ãƒˆ (system-integration.spec.ts)

#### âœ… æˆåŠŸãƒ†ã‚¹ãƒˆ
- **å®Œå…¨ãªãƒ•ãƒ©ã‚°ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«**: ä½œæˆâ†’è¡¨ç¤ºâ†’ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
- **ãƒšãƒ¼ã‚¸é–“ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³**: å…¨ãƒšãƒ¼ã‚¸ã®å‹•ä½œç¢ºèª
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: APIéšœå®³æ™‚ã®é©åˆ‡ãªå‡¦ç†
- **ä¸¦è¡Œå‡¦ç†**: è¤‡æ•°æ“ä½œã®åŒæ™‚å®Ÿè¡Œ
- **ç’°å¢ƒåˆ¥è©•ä¾¡**: development/staging/production
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°**: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®è‡ªå‹•æ›´æ–°
- **ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–**: ã‚»ãƒƒã‚·ãƒ§ãƒ³é–“ã§ã®ãƒ‡ãƒ¼ã‚¿ä¿æŒ
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: è² è·æ™‚ã®å¿œç­”æ€§èƒ½

#### ğŸ”‘ é‡è¦ãªå®Ÿè£…ãƒã‚¤ãƒ³ãƒˆ
```typescript
// ç’°å¢ƒåˆ¥ãƒ•ãƒ©ã‚°è©•ä¾¡ãƒ†ã‚¹ãƒˆ
const environments = ['development', 'staging', 'production'];
for (const env of environments) {
  const result = await page.evaluate(async (environment) => {
    const response = await fetch('http://localhost:3001/api/evaluate', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        tenantId: 'tenant-123',
        flagKey: 'test_flag_1',
        environment: environment
      })
    });
    return await response.json();
  }, env);
  
  expect(result.enabled).toBeDefined();
}
```

### 3. é«˜åº¦ãªæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ (advanced-flag-management.spec.ts)

#### âœ… æˆåŠŸãƒ†ã‚¹ãƒˆ
- **ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆåˆ†é›¢**: ç•°ãªã‚‹ãƒ†ãƒŠãƒ³ãƒˆã§ã®ãƒ•ãƒ©ã‚°ç‹¬ç«‹æ€§
- **è©•ä¾¡APIçµ±åˆ**: ãƒ•ãƒ©ã‚°è©•ä¾¡ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å‹•ä½œ
- **æœ‰åŠ¹æœŸé™ç®¡ç†**: æœŸé™åˆ‡ã‚Œãƒ•ãƒ©ã‚°ã®å‡¦ç†
- **æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**: è¤‡æ•°æ¡ä»¶ã§ã®çµã‚Šè¾¼ã¿
- **ãƒãƒ«ã‚¯æ“ä½œ**: è¤‡æ•°ãƒ•ãƒ©ã‚°ã®ä¸€æ‹¬å‡¦ç†ï¼ˆUIå®Ÿè£…æ™‚ï¼‰

#### âŒ æœªå®Ÿè£…æ©Ÿèƒ½ï¼ˆãƒ†ã‚¹ãƒˆå¤±æ•—ï¼‰
- **ãƒ•ãƒ©ã‚°æ›´æ–°**: ç·¨é›†æ©Ÿèƒ½ã®æœªå®Ÿè£…
- **ãƒ•ãƒ©ã‚°å‰Šé™¤**: å‰Šé™¤æ©Ÿèƒ½ã®æœªå®Ÿè£…
- **æœ‰åŠ¹/ç„¡åŠ¹ãƒˆã‚°ãƒ«**: ã‚¹ã‚¤ãƒƒãƒæ©Ÿèƒ½ã®æœªå®Ÿè£…

#### ğŸ”‘ é‡è¦ãªå®Ÿè£…ãƒã‚¤ãƒ³ãƒˆ
```typescript
// ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆåˆ†é›¢ãƒ†ã‚¹ãƒˆ
const customFlags = [
  {
    id: 'tenant1-flag1',
    flagKey: 'tenant1_feature',
    tenantId: 'tenant-1',
    owner: 'tenant1@example.com'
  },
  {
    id: 'tenant2-flag1',
    flagKey: 'tenant2_feature',
    tenantId: 'tenant-2',
    owner: 'tenant2@example.com'
  }
];

await fetch('http://localhost:3001/api/test/seed-custom', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ customFlags })
});
```

## ğŸ¯ æœ€é©åŒ–ã•ã‚ŒãŸé¸æŠçš„ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

### é–‹ç™ºä¸­ã®åŠ¹ç‡çš„ãªãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
```bash
# ã‚³ã‚¢æ©Ÿèƒ½ã®ã¿ï¼ˆæœ€é‡è¦ï¼‰
npm run test:e2e -- flag-management-live.spec.ts --project=chromium

# ã‚·ã‚¹ãƒ†ãƒ çµ±åˆã®ã¿
npm run test:e2e -- system-integration.spec.ts --project=chromium

# é«˜é€Ÿã§å®‰å®šã—ãŸãƒ†ã‚¹ãƒˆã®ã¿
npm run test:e2e -- "flag-management-live.spec.ts|system-integration.spec.ts" --project=chromium
```

### CI/CDã§ã®å®Ÿè¡Œ
```bash
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆå®Œå…¨ãªå“è³ªä¿è¨¼ï¼‰
npm run test:e2e -- --project=chromium

# ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹é‡è¦–ï¼ˆã‚³ã‚¢ãƒ†ã‚¹ãƒˆã®ã¿ï¼‰
npm run test:e2e -- "flag-management-live.spec.ts|system-integration.spec.ts|stable-flag-management.spec.ts" --project=chromium
```

## ğŸš€ ä»Šå¾Œã®æ‹¡å¼µãƒã‚¤ãƒ³ãƒˆ

### 1. æœªå®Ÿè£…æ©Ÿèƒ½ã®å®Ÿè£…
- ãƒ•ãƒ©ã‚°ç·¨é›†ãƒ»å‰Šé™¤æ©Ÿèƒ½
- æœ‰åŠ¹/ç„¡åŠ¹ãƒˆã‚°ãƒ«æ©Ÿèƒ½
- ãƒãƒ«ã‚¯æ“ä½œUI

### 2. è¿½åŠ ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª
- A/Bãƒ†ã‚¹ãƒˆæ©Ÿèƒ½
- æ®µéšçš„ãƒ­ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆ
- Kill-Switchæ©Ÿèƒ½
- ç›£æŸ»ãƒ­ã‚°æ©Ÿèƒ½

### 3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- å¤§é‡ãƒ•ãƒ©ã‚°ã§ã®å‹•ä½œç¢ºèª
- ä¸¦è¡Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã®è² è·ãƒ†ã‚¹ãƒˆ
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ã®æœ€é©åŒ–

## ğŸ” ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

#### 1. APIã‚µãƒ¼ãƒãƒ¼æ¥ç¶šã‚¨ãƒ©ãƒ¼
```bash
# è§£æ±ºæ–¹æ³•
cd packages/api
npm run dev
# APIã‚µãƒ¼ãƒãƒ¼ãŒ http://localhost:3001 ã§èµ·å‹•ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
```

#### 2. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼æ¥ç¶šã‚¨ãƒ©ãƒ¼
```bash
# è§£æ±ºæ–¹æ³•
cd packages/admin-ui
npm run dev
# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãŒ http://localhost:3000 ã§èµ·å‹•ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
```

#### 3. ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®ä¸æ•´åˆ
```bash
# è§£æ±ºæ–¹æ³•
curl -X POST http://localhost:3001/api/test/reset
curl -X POST http://localhost:3001/api/test/seed
# æ‰‹å‹•ã§ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ
```

### ãƒ‡ãƒãƒƒã‚°æ–¹æ³•
```bash
# UIãƒ¢ãƒ¼ãƒ‰ã§ãƒ‡ãƒãƒƒã‚°
npm run test:e2e:ui

# ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ãƒ¢ãƒ¼ãƒ‰ã§ãƒ‡ãƒãƒƒã‚°
npm run test:e2e -- --debug

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã®ã¿ãƒ‡ãƒãƒƒã‚°
npm run test:e2e -- flag-management-live.spec.ts --debug --project=chromium
```

## ğŸ“ˆ æˆåŠŸæŒ‡æ¨™

### å“è³ªæŒ‡æ¨™
- **æˆåŠŸç‡**: 83.8% (31/37)
- **å®Ÿè¡Œæ™‚é–“**: å¹³å‡58ç§’ï¼ˆå…¨ãƒ†ã‚¹ãƒˆï¼‰
- **å®‰å®šæ€§**: ãƒ•ãƒ¬ãƒ¼ã‚­ãƒ¼ãƒ†ã‚¹ãƒˆæ ¹çµ¶
- **ã‚«ãƒãƒ¬ãƒƒã‚¸**: ä¸»è¦æ©Ÿèƒ½100%

### ä¾¡å€¤æŒ‡æ¨™
- **çœŸã®çµ±åˆãƒ†ã‚¹ãƒˆ**: ãƒ¢ãƒƒã‚¯ä¾å­˜ã‹ã‚‰ã®è„±å´
- **å®Ÿéš›ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®å¿ å®Ÿãªå†ç¾
- **ç¶™ç¶šçš„å“è³ªä¿è¨¼**: è‡ªå‹•åŒ–ã•ã‚ŒãŸå“è³ªãƒã‚§ãƒƒã‚¯
- **é–‹ç™ºåŠ¹ç‡**: ä¿¡é ¼ã§ãã‚‹ãƒ†ã‚¹ãƒˆãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯

---

**ã“ã®æ®µéšçš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã«ã‚ˆã‚Šã€ãƒ•ãƒ¬ãƒ¼ã‚­ãƒ¼ãƒ†ã‚¹ãƒˆã®æ ¹æœ¬çš„è§£æ±ºã¨çœŸã®E2Eãƒ†ã‚¹ãƒˆã®ä¾¡å€¤å®Ÿç¾ã‚’é”æˆã—ã¾ã—ãŸã€‚**