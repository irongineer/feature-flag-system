# Definition of Done (DoD) - フィーチャーフラグシステム

## 概要

本ドキュメントはフィーチャーフラグシステム開発における品質基準と完了条件を定義します。フェーズ3以降の開発では、すべてのタスクがこのDoDを満たすまで完了とみなされません。

## 🎯 プロジェクト全体 DoD

### 必須要件
- [ ] **機能実装**: 要求仕様を100%満たす
- [ ] **テスト実装**: カバレッジ90%以上（単体・統合・E2E）
- [ ] **コードレビュー**: t-wada氏による承認完了
- [ ] **ドキュメント**: 実装内容の文書化完了
- [ ] **CI/CD**: 全自動テストが通過
- [ ] **セキュリティ**: セキュリティスキャン通過
- [ ] **パフォーマンス**: 要求性能基準達成
- [ ] **技術的負債**: 新規負債の文書化と計画策定

### 品質ゲート
1. **Code Quality Gate**: ESLint, Prettier, TypeScript checks通過
2. **Test Quality Gate**: 全テスト通過 + カバレッジ要件達成
3. **Security Gate**: CodeQL, npm audit通過
4. **Performance Gate**: ベンチマークテスト基準達成
5. **Review Gate**: t-wada氏による設計・実装レビュー承認

## 📋 タスクタイプ別 DoD

### 🔧 [TASK] - 技術的タスク

#### 実装要件
- [ ] **コード品質**
  - TypeScript型安全性100%（`any`使用禁止）
  - ESLint + SonarJS ルール違反ゼロ
  - Prettier フォーマット適用
  - 関数・クラスの責務明確化（単一責任原則）

- [ ] **テスト要件**
  - 単体テスト: 実装関数の90%以上カバー
  - 統合テスト: 主要パス100%カバー
  - エラーケーステスト: 想定エラーシナリオ網羅
  - パフォーマンステスト: 要求性能基準達成

- [ ] **ドキュメント要件**
  - JSDoc/TSDoc コメント（public API）
  - README更新（必要に応じて）
  - アーキテクチャ図更新（構造変更時）
  - CHANGELOG.md更新

#### 設計要件
- [ ] **Clean Architecture準拠**
  - レイヤー分離（Domain, Use Case, Infrastructure）
  - 依存関係逆転の原則適用
  - ドメインロジックの純粋性維持

- [ ] **SOLID原則適用**
  - Single Responsibility: 単一責任
  - Open/Closed: 拡張に開いて修正に閉じる
  - Liskov Substitution: 置換可能性
  - Interface Segregation: インターフェース分離
  - Dependency Inversion: 依存関係逆転

### 📖 [STORY] - ユーザーストーリー

#### 機能要件
- [ ] **受入条件達成**
  - 全受入条件（Acceptance Criteria）満たす
  - ユーザビリティテスト実施（該当する場合）
  - アクセシビリティ要件達成（WCAG 2.1 AA）

- [ ] **統合要件**
  - API統合テスト完了
  - 認証・認可テスト完了
  - エラーハンドリング検証完了

- [ ] **E2Eテスト**
  - 主要ユーザーフロー100%カバー
  - 異常系シナリオ網羅
  - パフォーマンス要件検証

#### UX/UI要件
- [ ] **デザイン要件**
  - デザインシステム準拠
  - レスポンシブデザイン対応
  - ダークモード対応（該当する場合）

### 🔧 [TECHNICAL DEBT] - 技術的負債

#### 改善要件
- [ ] **問題解決**
  - 特定された問題の完全解決
  - 回帰防止策実装
  - 関連テストの安定化

- [ ] **影響評価**
  - 既存機能への影響ゼロ
  - パフォーマンス改善効果測定
  - 保守性向上の確認

## 🔍 コードレビュー基準 (t-wada Review Criteria)

### 設計レビュー
- [ ] **アーキテクチャ適合性**
  - 既存設計パターンとの整合性
  - 拡張性・保守性の考慮
  - パフォーマンス影響の評価

- [ ] **テスト設計**
  - TDD/BDDアプローチ適用
  - テストケースの網羅性
  - テストの可読性・保守性

### 実装レビュー
- [ ] **コード品質**
  - 命名規則の一貫性
  - 可読性・理解しやすさ
  - パフォーマンス最適化

- [ ] **セキュリティ**
  - セキュリティベストプラクティス適用
  - 入力検証・サニタイゼーション
  - 認証・認可の適切な実装

## 🚀 PR (Pull Request) 基準

### PR作成要件
- [ ] **1 Issue = 1 PR**
  - 1つのPRは1つのIssueにのみ対応
  - 複数Issueの混在禁止
  - 適切なサイズでの分割

- [ ] **PR情報**
  - 明確なタイトル（Issue番号含む）
  - 変更内容の詳細説明
  - テスト実行結果の記載
  - 関連Issueリンク

### PR品質基準
- [ ] **変更サイズ**
  - コード変更: 200行以下（理想）
  - ファイル数: 10ファイル以下（理想）
  - レビュー可能な適切なサイズ

- [ ] **完全性**
  - 全CI/CDチェック通過
  - コンフリクト解決済み
  - 最新mainブランチとのマージ準備完了

## 📊 品質メトリクス

### 必須メトリクス
| メトリクス | 基準値 | 測定方法 |
|-----------|-------|---------|
| テストカバレッジ | 90%以上 | Vitest coverage |
| TypeScript型安全性 | 100% | tsc --noEmit |
| ESLint違反 | 0件 | ESLint scan |
| セキュリティ脆弱性 | 0件（High/Critical） | npm audit + CodeQL |
| パフォーマンス | 既定基準達成 | ベンチマークテスト |

### 監視メトリクス
- コードレビュー時間: 2営業日以内
- PR修正サイクル: 平均3回以内
- CI/CD実行時間: 10分以内

## 🔄 プロセスフロー

### 1. Issue作成
```
必要に応じてIssue作成 → ラベル設定 → 見積もり → アサイン
```

### 2. 開発フェーズ
```
ブランチ作成 → TDD実装 → テスト作成 → ドキュメント更新
```

### 3. レビューフェーズ
```
PR作成 → CI/CD実行 → t-wadaレビュー → 修正対応 → 承認
```

### 4. マージフェーズ
```
最終確認 → マージ → Issue クローズ → デプロイ（該当時）
```

## 🚫 NG行為

### 禁止事項
- [ ] **マルチIssue PR**: 複数Issueを1つのPRで処理
- [ ] **巨大PR**: 500行を超える変更（例外時は事前相談）
- [ ] **テスト不備**: テストカバレッジ不足でのPR作成
- [ ] **レビュー回避**: 緊急時でもレビュー省略禁止
- [ ] **技術的負債隠蔽**: 新規技術的負債の未文書化

### 品質妥協禁止
- `any`型の使用（型定義困難時は`unknown`使用）
- ESLintルール無効化（`eslint-disable`）
- テストスキップ（`test.skip`、`describe.skip`）
- セキュリティチェック回避

## 📚 参考資料

### 開発ガイドライン
- [Clean Architecture](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html) - Robert C. Martin
- [Test Driven Development](https://www.amazon.com/Test-Driven-Development-Kent-Beck/dp/0321146530) - Kent Beck
- [Refactoring](https://refactoring.com/) - Martin Fowler

### プロジェクト固有資料
- [CLAUDE.md](../../CLAUDE.md) - プロジェクト開発ガイド
- [ADR Documentation](../architecture/design-decisions.md) - アーキテクチャ決定記録
- [Technical Debt Log](../architecture/technical-debt-log.md) - 技術的負債管理

---

**最終更新**: 2025-07-12  
**承認者**: t-wada  
**次回レビュー**: フェーズ3完了時