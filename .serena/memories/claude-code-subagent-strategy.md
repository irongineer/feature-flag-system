# Claude Code サブエージェント戦略 - フィーチャーフラグシステム最適化

## 🎯 プロジェクト特性分析

### 現在のプロジェクト状況
- **技術スタック**: React + Node.js + TypeScript + AWS (DynamoDB/Lambda/CDK)
- **開発手法**: 1Issue1PR + Expert Review + TDD
- **品質基準**: テストカバレッジ90%以上、型安全性100%
- **環境**: local/dev/prod 3環境対応済み
- **フェーズ**: Phase 1.5完了、Phase 2拡張機能開発へ

### 開発プロセスの特徴
1. **Expert Review体制**: DDD・アーキテクチャ・TDD観点での厳格なレビュー
2. **DoD遵守**: Definition of Done 7項目の完全達成必須
3. **マルチ環境対応**: 環境別設定とデータ分離の複雑性
4. **品質重視**: 90%以上のテストカバレッジと型安全性

## 🤖 サブエージェント最適活用戦略

### 1. 【開発フェーズ別】サブエージェント活用マップ

#### Phase A: 要件定義・設計フェーズ
```
🎯 general-purpose agent
├── 要件分析・技術調査
├── アーキテクチャ設計検討  
├── API設計ドキュメント作成
└── 技術選定理由書作成

📋 活用例:
- 新機能(A/Bテスト機能)の技術調査
- DynamoDB設計パターンの検討
- セキュリティ要件の分析
```

#### Phase B: 実装フェーズ
```
🎯 general-purpose agent (コード実装専門)
├── TypeScript型安全実装
├── React Component開発
├── API Handler実装
└── DynamoDB操作実装

📋 活用例:
- フラグ評価エンジンの高速化実装
- 管理画面の新UI Component作成
- Lambda関数の最適化実装
```

#### Phase C: テスト・品質保証フェーズ
```
🎯 general-purpose agent (テスト専門)
├── ユニットテスト実装 (90%カバレッジ達成)
├── E2Eテストシナリオ作成
├── パフォーマンステスト実装
└── セキュリティテスト実装

📋 活用例:
- 新機能のテストケース網羅
- Playwright E2Eテスト追加
- 負荷テストシナリオ作成
```

#### Phase D: デプロイ・運用フェーズ
```
🎯 general-purpose agent (DevOps専門)
├── CDKインフラコード更新
├── CI/CDパイプライン改善
├── モニタリング設定
└── 運用手順書更新

📋 活用例:
- 新環境のCDK定義作成
- GitHub Actions ワークフロー最適化
- CloudWatch アラーム設定
```

### 2. 【Expert Review観点別】サブエージェント特化戦略

#### Eric Evans (DDD観点) サポート
```bash
# DDD専門のサブエージェント活用
Task: "DDD観点でのドメインモデル設計とレビュー"

🎯 専門領域:
- 境界コンテキストの明確化
- ユビキタス言語の一貫性チェック
- ドメインオブジェクトの適切性検証
- 集約ルートの設計妥当性
```

#### Martin Fowler (アーキテクチャ観点) サポート
```bash
# アーキテクチャ専門のサブエージェント活用
Task: "システムアーキテクチャの設計と技術的負債分析"

🎯 専門領域:
- レイヤードアーキテクチャの検証
- 責務分離の適切性チェック
- 拡張性・保守性の評価
- リファクタリング戦略立案
```

#### 和田卓人 (TDD・品質観点) サポート
```bash
# TDD・品質専門のサブエージェント活用
Task: "TDD実践とテスト品質向上支援"

🎯 専門領域:
- Red-Green-Refactorサイクルの実践支援
- テストカバレッジ90%達成支援
- テスト設計・テストケース作成
- 品質メトリクス分析
```

### 3. 【実装タスク別】最適サブエージェント選択

#### 🔍 複雑な技術調査・分析タスク
```typescript
// 例: 段階的ロールアウト機能の技術調査
Task({
  subagent_type: "general-purpose",
  description: "段階的ロールアウト技術調査",
  prompt: `
    フィーチャーフラグシステムに段階的ロールアウト機能を追加したい。
    以下の観点で技術調査と実装戦略を立案：
    
    1. DynamoDBでのパーセンテージ配信データモデル設計
    2. リアルタイム配信割合変更の実現方法
    3. メトリクス収集とロールバック戦略
    4. 既存アーキテクチャとの整合性
    5. TypeScript型安全性の保持
    
    調査結果として以下を出力：
    - 技術選定理由書
    - データモデル設計案
    - API設計案
    - 実装スケジュール案
  `
});
```

#### 🛠️ 複雑なコード実装タスク
```typescript
// 例: A/Bテスト機能の本格実装
Task({
  subagent_type: "general-purpose", 
  description: "A/Bテスト機能実装",
  prompt: `
    フィーチャーフラグシステムにA/Bテスト機能を実装。
    以下の要件を満たすコードを作成：
    
    実装要件:
    - TypeScript完全対応 (型安全性100%)
    - テストカバレッジ90%以上
    - 3環境(local/dev/prod)対応
    - Expert Review基準クリア
    
    実装範囲:
    1. packages/core/: A/Bテスト評価エンジン
    2. packages/api/: A/BテストAPI (CRUD + 統計)  
    3. packages/admin-ui/: A/Bテスト管理画面
    4. テスト: ユニット・統合・E2Eテスト
    5. ドキュメント: API仕様・実装ガイド
    
    1Issue1PR原則に従い、適切なPR分割も提案。
  `
});
```

#### 📊 テスト・品質保証タスク
```typescript
// 例: パフォーマンステスト実装
Task({
  subagent_type: "general-purpose",
  description: "パフォーマンステスト実装", 
  prompt: `
    フィーチャーフラグシステムのパフォーマンステストを実装。
    
    テスト要件:
    - フラグ評価API: 100ms以下レスポンス
    - 管理API: 500ms以下レスポンス  
    - 同時接続: 1000リクエスト/秒対応
    - DynamoDB読み取り最適化検証
    
    実装内容:
    1. 負荷テストシナリオ作成 (Jest/Vitest)
    2. パフォーマンスメトリクス計測
    3. ボトルネック特定・改善提案
    4. CI/CDパイプライン統合
    5. 継続監視体制構築
    
    DoD基準に従い、テストカバレッジと品質基準を満たす。
  `
});
```

### 4. 【継続的改善】サブエージェント運用戦略

#### 🔄 週次品質レビュー
```bash
# 毎週金曜日実行
npm run docs:check  # ドキュメントリンクチェック

# サブエージェント活用
Task: "週次品質レビューと改善提案"
- テストカバレッジ分析
- 技術的負債特定  
- パフォーマンス分析
- セキュリティ脆弱性チェック
```

#### 📈 月次アーキテクチャレビュー
```bash
# サブエージェント活用
Task: "月次アーキテクチャレビューと最適化提案"
- システム全体の健全性チェック
- 新技術動向の調査・適用検討
- スケーラビリティ課題の特定
- 運用効率化の提案
```

## 🚀 即座に実践可能な活用例

### 1. 次のPhase 2機能開発
```typescript
// A/Bテスト機能の技術調査
Task({
  subagent_type: "general-purpose",
  description: "A/Bテスト技術調査",
  prompt: `
    現在のフィーチャーフラグシステム(Phase 1.5完了)に
    A/Bテスト機能を追加する技術調査を実施。
    
    調査範囲:
    1. 既存DynamoDB設計との統合方法
    2. 統計的有意性検定の実装方式
    3. リアルタイムメトリクス収集
    4. TypeScript型定義拡張
    5. React管理画面のUX設計
    
    Expert Review基準(DDD・アーキテクチャ・TDD)を
    満たす設計案を提案してください。
  `
});
```

### 2. 技術的負債解消
```typescript
// コードベース全体の技術的負債分析
Task({
  subagent_type: "general-purpose", 
  description: "技術的負債分析",
  prompt: `
    packages/core、packages/api、packages/admin-ui
    の技術的負債を分析し、優先度付きの改善計画を立案。
    
    分析観点:
    1. Martin Fowler基準でのアーキテクチャ改善点
    2. TypeScript型安全性の向上余地
    3. テストカバレッジ90%未達成箇所
    4. パフォーマンス最適化機会
    5. セキュリティ強化ポイント
    
    1Issue1PR原則に従った実装計画も併せて提案。
  `
});
```

## 📋 実装チェックリスト

### ✅ 即座に始められること
- [ ] general-purpose agentでPhase 2機能の技術調査
- [ ] 複雑なコード実装タスクのサブエージェント活用
- [ ] Expert Review観点別の専門サポート体制構築
- [ ] 品質保証・テスト実装の自動化

### 🎯 1週間以内の目標
- [ ] A/Bテスト機能の技術調査完了
- [ ] サブエージェント活用ガイドライン策定
- [ ] 技術的負債の優先度付きリスト作成
- [ ] パフォーマンステスト実装計画立案

### 🚀 1ヶ月以内の目標  
- [ ] Phase 2機能開発でのサブエージェント本格活用
- [ ] 継続的品質改善体制の確立
- [ ] Expert Review効率化の実現
- [ ] 開発生産性の定量的向上(20%以上)

このサブエージェント戦略により、フィーチャーフラグシステムの開発効率と品質を大幅に向上させることができます。